// 专家对话提示词构建器
class ExpertPromptBuilder {
    // 获取专家特定的分析框架
    static getExpertFramework(expertise) {
        const frameworks = {
            '八字': {
                theory: '十神论、五行生克、纳音五行、六亲关系、阴阳五行、十二长生、天干地支、四柱关系、十神力量、命局格局、五行健旺、阴阳配比',
                focus: '日主强弱、格局判定、大运流年、十神力量、五行平衡、阴阳配比、六亲旺衰、命局喜忌、格局用神、调候用神、神煞关系、运势变化',
                methods: '神煞分析、十神制化、五行补泻、格局用神、调候用神、纳音配伍、六亲关系、长生旺衰、格局补救、神煞化解、运势调理、趋吉避凶',
                timing: '流年流月、大运小运、日辰吉凶、四柱关系、十二长生、空亡刑冲、天干地支、节气变化、运势流转、神煞周期、五行旺衰、吉凶时刻',
                expertise: {
                    格局理论: ['从格入运', '格局用神', '调候用神', '格局补救', '格局变化', '格局转化', '格局平衡', '格局调理'],
                    神煞体系: ['天干神煞', '地支神煞', '四柱神煞', '长生神煞', '岁运神煞', '流年神煞', '月令神煞', '时辰神煞'],
                    五行理论: ['生克制化', '五行健旺', '五行从化', '五行相生相克', '五行补泻', '五行平衡', '五行转化', '五行调理'],
                    六亲关系: ['六亲旺衰', '六亲生克', '六亲互动', '六亲变化', '六亲制化', '六亲调理', '六亲平衡', '六亲转化'],
                    运势分析: ['大运流年', '流月流日', '运势变化', '吉凶预测', '运势调理', '运势转化', '运势平衡', '运势补救']
                }
            },
            '紫微斗数': {
                theory: '星曜组合、四化星、三方四正、十二宫位、五行生克、四化飞星、诸星会合、宫位关系、星耀变化、宫位飞化、命盘格局、星曜制化',
                focus: '主星配置、宫位分析、流限冲会、星曜组合、四化变化、三方会照、宫位迁移、命宫特征、星曜制化、宫位关系、命盘格局、运势变化',
                methods: '星曜制化、吉凶判定、宫位趋避、星耀组合、四化变迁、三方四正、宫位冲会、星曜变化、格局判定、运势预测、宫位调理、星曜平衡',
                timing: '流年流月、大限小限、星动吉凶、宫位流转、四化游移、限运交替、流年四化、星曜迁移、运势变化、宫位周期、星曜周期、吉凶时刻',
                expertise: {
                    主星体系: ['紫微星系', '天府星系', '八大主星', '主星组合', '主星变化', '主星制化', '主星调理', '主星平衡'],
                    辅星理论: ['辅星作用', '辅星组合', '辅星变化', '辅星制化', '辅星关系', '辅星调理', '辅星平衡', '辅星转化'],
                    四化理论: ['四化生克', '四化飞星', '四化变迁', '四化作用', '四化关系', '四化调理', '四化平衡', '四化转化'],
                    宫位体系: ['十二宫位', '三方四正', '宫位冲会', '宫位迁移', '宫位关系', '宫位调理', '宫位平衡', '宫位转化'],
                    运势分析: ['大限流年', '小限流月', '流限交会', '运势变化', '运势调理', '运势转化', '运势平衡', '运势补救']
                }
            },
            '六爻': {
                theory: '卦象变化、爻位吉凶、五行生克、六亲关系、卦爻动静、世应关系、卦变占断、游魂归魂、变卦规律、卦象组合、爻位变化、卦理演绎',
                focus: '动静分析、卦变占断、世应关系、六亲生克、五行旺衰、卦爻变化、吉凶断定、趋势预测、卦象解读、爻位判断、变卦分析、卦理推演',
                methods: '六亲断法、卦变趋势、吉凶断定、世应分析、五行生克、动静判断、变爻分析、占断法则、卦象推演、爻位解读、变卦预测、卦理应用',
                timing: '月建日辰、卦变时效、趋势预测、节气变化、时辰吉凶、卦象流转、爻变时序、动静时效、卦象周期、爻位周期、变卦周期、吉凶时刻',
                expertise: {
                    卦象理论: ['八卦属性', '六十四卦', '游魂归魂', '卦象变化', '卦象组合', '卦象制化', '卦象调理', '卦象平衡'],
                    爻位体系: ['六爻位置', '爻位吉凶', '爻位变化', '爻位关系', '爻位制化', '爻位调理', '爻位平衡', '爻位转化'],
                    变卦理论: ['变卦规律', '变卦意义', '变卦断法', '变卦时效', '变卦关系', '变卦调理', '变卦平衡', '变卦转化'],
                    世应体系: ['世应关系', '世应变化', '世应断法', '世应预测', '世应制化', '世应调理', '世应平衡', '世应转化'],
                    五行断法: ['五行生克', '五行旺衰', '五行制化', '五行变化', '五行关系', '五行调理', '五行平衡', '五行转化']
                }
            },
            '梅花易数': {
                theory: '数值变化、五行生克、卦象演变、数理推演、象数结合、时空变化、数理循环、易理演绎、数象关系、易理规律、数理变化、象数演化',
                focus: '数理推演、卦象分析、变化规律、数象结合、时空演变、数理预测、象数互动、规律判定、数理解读、象数预测、变化分析、规律应用',
                methods: '数理断法、卦象解读、趋势预测、数值分析、象数结合、规律推演、变化预测、数理推导、象数判断、规律解读、数理应用、变化推演',
                timing: '时效判断、变化周期、吉凶预测、数理循环、时空转换、节气变迁、数象流转、规律演变、数理周期、象数周期、变化周期、吉凶时刻',
                expertise: {
                    数理体系: ['数值原理', '数理变化', '数值关系', '数理循环', '数理制化', '数理调理', '数理平衡', '数理转化'],
                    象数理论: ['象数结合', '象数变化', '象数互动', '象数演变', '象数制化', '象数调理', '象数平衡', '象数转化'],
                    变化规律: ['规律推演', '规律应用', '规律预测', '规律验证', '规律制化', '规律调理', '规律平衡', '规律转化'],
                    时空分析: ['时空变化', '时空转换', '时空预测', '时空应用', '时空制化', '时空调理', '时空平衡', '时空转化'],
                    预测技术: ['趋势分析', '变化预测', '周期判断', '规律应用', '预测制化', '预测调理', '预测平衡', '预测转化']
                }
            },
            '奇门遁甲': {
                theory: '三奇六仪、八门九星、遁甲时空、天盘地盘、阴阳五行、遁甲九宫、八卦方位、时空变化、遁甲规律、门星配合、遁甲飞宫、阴阳遁转',
                focus: '盘局分析、门户吉凶、星辰变化、遁甲规律、时空转换、九宫飞遁、八门吉凶、九星变化、遁甲周期、门户变化、星辰配合、遁甲预测',
                methods: '三奇断法、六仪解读、遁甲推演、门户分析、星辰判定、九宫预测、八门断法、九星解读、遁甲占断、门户预测、星辰推演、遁甲应用',
                timing: '遁甲时空、节气变化、三元九运、八门流转、九星周期、遁甲变化、门户流转、星辰运动、遁甲周期、吉凶时刻、遁甲节律、时空转换',
                expertise: {
                    遁甲理论: ['三奇六仪', '八门九星', '遁甲九宫', '遁甲飞宫', '遁甲规律', '遁甲变化', '遁甲调理', '遁甲平衡'],
                    门户体系: ['八门断法', '门户吉凶', '门户变化', '门户关系', '门户制化', '门户调理', '门户平衡', '门户转化'],
                    星辰系统: ['九星断法', '星辰吉凶', '星辰变化', '星辰关系', '星辰制化', '星辰调理', '星辰平衡', '星辰转化'],
                    九宫分析: ['九宫断法', '九宫吉凶', '九宫变化', '九宫关系', '九宫制化', '九宫调理', '九宫平衡', '九宫转化'],
                    时空预测: ['时空断法', '时空吉凶', '时空变化', '时空关系', '时空制化', '时空调理', '时空平衡', '时空转化']
                }
            },
            '大六壬': {
                theory: '天地盘、十二神将、四课八课、三传变化、五行生克、十二长生、神煞系统、课体变化、占断理论、神将配合、课体规律、天时地理',
                focus: '四课解读、八课分析、三传推演、神将变化、课体判定、占断规律、神煞关系、时空转换、课体特征、神将配合、占断预测、时空分析',
                methods: '四课断法、八课推演、三传分析、神将判定、课体解读、占断推理、神煞断法、时空预测、课体推演、神将解读、占断应用、时空判断',
                timing: '天时地理、节气变化、神将周期、课体流转、占断时效、神煞变化、课体周期、神将运动、占断节律、吉凶时刻、课体节奏、时空转换',
                expertise: {
                    课体理论: ['四课八课', '三传变化', '课体规律', '课体特征', '课体制化', '课体调理', '课体平衡', '课体转化'],
                    神将系统: ['十二神将', '神将变化', '神将配合', '神将关系', '神将制化', '神将调理', '神将平衡', '神将转化'],
                    占断体系: ['占断规律', '占断推理', '占断预测', '占断关系', '占断制化', '占断调理', '占断平衡', '占断转化'],
                    神煞分析: ['神煞系统', '神煞变化', '神煞关系', '神煞特征', '神煞制化', '神煞调理', '神煞平衡', '神煞转化'],
                    时空判断: ['时空规律', '时空变化', '时空预测', '时空关系', '时空制化', '时空调理', '时空平衡', '时空转化']
                }
            },
            '太乙神数': {
                theory: '太乙数理、十二神将、五行生克、太乙九宫、数理变化、神将配合、九宫飞布、太乙规律、占断理论、神将变化、数理规律、时空转换',
                focus: '太乙分析、神将变化、数理推演、九宫变化、占断规律、神将配合、数理特征、九宫特点、占断预测、神将关系、数理应用、时空分析',
                methods: '太乙断法、神将推演、数理分析、九宫判定、占断推理、神将解读、数理推导、九宫预测、占断应用、神将判定、数理应用、时空判断',
                timing: '太乙周期、神将运动、数理变化、九宫流转、占断时效、神将周期、数理节律、九宫周期、占断节奏、吉凶时刻、数理节点、时空转换',
                expertise: {
                    太乙理论: ['太乙数理', '太乙规律', '太乙变化', '太乙特征', '太乙制化', '太乙调理', '太乙平衡', '太乙转化'],
                    神将系统: ['十二神将', '神将变化', '神将配合', '神将关系', '神将制化', '神将调理', '神将平衡', '神将转化'],
                    数理分析: ['数理规律', '数理变化', '数理推演', '数理关系', '数理制化', '数理调理', '数理平衡', '数理转化'],
                    九宫体系: ['九宫规律', '九宫变化', '九宫预测', '九宫关系', '九宫制化', '九宫调理', '九宫平衡', '九宫转化'],
                    占断预测: ['占断规律', '占断变化', '占断推理', '占断关系', '占断制化', '占断调理', '占断平衡', '占断转化']
                }
            },
            '皇极经世': {
                theory: '皇极数理、五行生克、世运变化、皇极八卦、数理推演、运势循环、八卦变化、皇极规律、占断理论、运势变化、数理规律、时空转换',
                focus: '皇极分析、运势变化、数理推演、八卦变化、占断规律、运势配合、数理特征、八卦特点、占断预测、运势关系、数理应用、时空分析',
                methods: '皇极断法、运势推演、数理分析、八卦判定、占断推理、运势解读、数理推导、八卦预测、占断应用、运势判定、数理应用、时空判断',
                timing: '皇极周期、运势运动、数理变化、八卦流转、占断时效、运势周期、数理节律、八卦周期、占断节奏、吉凶时刻、数理节点、时空转换',
                expertise: {
                    皇极理论: ['皇极数理', '皇极规律', '皇极变化', '皇极特征', '皇极制化', '皇极调理', '皇极平衡', '皇极转化'],
                    运势系统: ['运势规律', '运势变化', '运势配合', '运势关系', '运势制化', '运势调理', '运势平衡', '运势转化'],
                    数理分析: ['数理规律', '数理变化', '数理推演', '数理关系', '数理制化', '数理调理', '数理平衡', '数理转化'],
                    八卦体系: ['八卦规律', '八卦变化', '八卦预测', '八卦关系', '八卦制化', '八卦调理', '八卦平衡', '八卦转化'],
                    占断预测: ['占断规律', '占断变化', '占断推理', '占断关系', '占断制化', '占断调理', '占断平衡', '占断转化']
                }
            },
            '运势分析': {
                theory: '命理规律、五行生克、运势循环、吉凶判定、趋势预测、时空变化、能量流转、运程演变、运势规律、时运变化、运程规律、能量转换',
                focus: '运势分析、事业运程、财运变化、感情运势、健康状况、学业发展、人际关系、家庭运势、出行运程、投资机遇、发展方向、运势调整',
                methods: '运势预测、趋势分析、运程判定、吉凶断定、运势推演、能量调节、运程规划、运势调理、运势预测、运程分析、运势判断、运程调整',
                timing: '运势周期、时运变化、运程节点、吉运时段、凶运预警、运势转折、能量周期、运程流转、运势变化、时运节点、运程周期、运势节律',
                expertise: {
                    事业运势: ['事业方向', '职业发展', '创业机会', '升迁机遇', '事业制化', '事业调理', '事业平衡', '事业转化'],
                    财运分析: ['财运来源', '理财方向', '投资机会', '财运预测', '财运制化', '财运调理', '财运平衡', '财运转化'],
                    感情运势: ['感情状态', '桃花运势', '婚姻预测', '情感发展', '感情制化', '感情调理', '感情平衡', '感情转化'],
                    健康运程: ['健康状况', '疾病预防', '养生方向', '康复预测', '健康制化', '健康调理', '健康平衡', '健康转化'],
                    综合预测: ['运势预测', '趋势分析', '机遇把握', '风险预警', '运势制化', '运势调理', '运势平衡', '运势转化']
                }
            },
            '五行分析': {
                theory: '五行生克、阴阳平衡、五行配比、能量转化、五行关系、五行制化、五行循环、能量流转、五行规律、阴阳变化、五行演变、能量规律',
                focus: '五行配置、阴阳比例、能量强弱、五行关系、生克制化、平衡状态、能量流转、五行调节、阴阳调和、能量补充、五行调整、能量优化',
                methods: '五行分析、阴阳判定、能量测算、五行推演、生克断定、平衡调节、能量补泻、五行调理、阴阳调和、能量优化、五行调整、平衡优化',
                timing: '五行周期、阴阳变化、能量流转、五行节律、生克时序、平衡节点、能量周期、五行流转、阴阳周期、能量节点、五行节点、平衡时机',
                expertise: {
                    五行理论: ['五行生克', '五行制化', '五行关系', '五行变化', '五行制化', '五行调理', '五行平衡', '五行转化'],
                    阴阳分析: ['阴阳配比', '阴阳关系', '阴阳变化', '阴阳转化', '阴阳制化', '阴阳调理', '阴阳平衡', '阴阳优化'],
                    能量分析: ['能量强弱', '能量流转', '能量变化', '能量转化', '能量制化', '能量调理', '能量平衡', '能量优化'],
                    平衡调节: ['平衡状态', '平衡调节', '平衡变化', '平衡转化', '平衡制化', '平衡调理', '平衡优化', '平衡提升'],
                    补泻技术: ['补泻方法', '补泻时机', '补泻变化', '补泻转化', '补泻制化', '补泻调理', '补泻平衡', '补泻优化']
                }
            }
        };
        return frameworks[expertise] || frameworks['八字']; // 默认使用八字框架
    }

    // 构建基础人设提示词
    static buildBasePrompt(expertise, previousAnalysis) {
        const framework = this.getExpertFramework(expertise);
        return `作为一位资深的${expertise}专家，我将基于${framework.theory}的理论体系，对您的命盘进行深入分析。基于之前的分析结果：

${previousAnalysis}

在接下来的对话中，我将：
1. 运用${framework.theory}进行专业分析
2. 重点关注${framework.focus}
3. 通过${framework.methods}提供解决方案
4. 结合${framework.timing}进行时间判断
5. 给出切实可行的改善建议
6. 注重趋吉避凶的实际指导

您可以询问：
- ${expertise}理论的具体应用
- 命盘特点的深入解读
- 运势变化的关键时点
- 具体事项的吉凶判断
- 如何趋吉避凶的实操建议

我会基于${expertise}的独特理论体系，为您提供专业、准确的解答。请问您想了解哪些方面？`;
    }

    // 构建对话提示词
    static buildChatPrompt(expertise, previousAnalysis, userQuestion) {
        const framework = this.getExpertFramework(expertise);
        return `作为一位资深的${expertise}专家，我将基于您的命盘特点和之前的分析：

${previousAnalysis}

针对您的问题：${userQuestion}

我将从${expertise}的专业角度进行分析：

1. 理论基础分析
   - 运用${framework.theory}
   - 分析命盘特点
   - 判断基本格局
   - 评估总体趋势

2. 专业深度分析
   - 重点关注${framework.focus}
   - 分析关键影响因素
   - 评估各种可能性
   - 预测发展趋势

3. 解决方案规划
   - 运用${framework.methods}
   - 制定改善策略
   - 提供具体建议
   - 说明注意事项

4. 时间规划
   - 基于${framework.timing}
   - 选择最佳时机
   - 预测关键节点
   - 规划行动时序

5. 综合建议
   - 结合命盘特点
   - 提供实操方案
   - 说明禁忌事项
   - 规划长期策略

请让我基于${expertise}的理论体系，为您提供专业、详实的解答：`;
    }

    // 构建总结提示词
    static buildSummaryPrompt(expertise, conversation) {
        const framework = this.getExpertFramework(expertise);
        return `作为一位资深的${expertise}专家，我将对我们的对话进行系统总结：

对话记录：
${conversation}

基于${expertise}的理论体系，从以下方面进行总结：

1. 命理分析要点
   - ${framework.theory}分析
   - ${framework.focus}特点
   - 总体格局判断
   - 关键影响因素

2. 问题诊断
   - 核心问题本质
   - ${expertise}理论分析
   - 制约因素判定
   - 发展趋势预测

3. 解决方案
   - 基于${framework.methods}
   - 具体实施步骤
   - 时间节点选择
   - 注意事项说明

4. 时间规划
   - 基于${framework.timing}
   - 近期行动建议
   - 中期发展规划
   - 长期策略制定

5. 趋吉避凶指导
   - 有利因素利用
   - 不利因素化解
   - 开运方法建议
   - 禁忌事项提醒

以上总结基于${expertise}的专业理论，旨在帮助您更好地理解和执行建议：`;
    }

    // 构建错误提示词
    static buildErrorPrompt(expertise) {
        const framework = this.getExpertFramework(expertise);
        return `抱歉，作为${expertise}专家，我暂时无法回答您的问题。这可能是因为：

1. 技术原因
   - 网络连接不稳定
   - 服务暂时繁忙
   - 系统正在维护

2. 专业分析原因
   - 需要更完整的命盘信息
   - 问题需要更具体的描述
   - 可能超出${expertise}的理论范畴

3. ${expertise}理论限制
   - 需要结合${framework.theory}
   - 可能需要${framework.focus}的补充信息
   - 需要更多${framework.timing}的具体信息

建议您：
1. 稍后重新提问
2. 提供更详细的命盘信息
3. 将复杂问题拆分为具体问题
4. 确保问题在${expertise}领域范围内

如果问题持续存在，您可以：
1. 查看之前的分析结果
2. 换个角度提出问题
3. 考虑结合其他命理学派进行分析

感谢您的理解。我们会努力提供更专业的${expertise}分析服务。`;
    }
}

// 导出提示词构建器
window.ExpertPromptBuilder = ExpertPromptBuilder; 